{% extends 'base.html' %}

{% block title %}Home - My Website{% endblock %}

{% block content %}
<h6 class="text-center text-danger mx-3 my-0 p-0">Table No: {{table_id}}</h6>
<div class="row m-0 p-0 mb-2">
    <div class="col-6 text-center">
        <!-- Button to trigger delete confirmation modal -->
        <button type="button" class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#deleteModal">
            Delete Record
        </button>

        <!-- Delete Confirmation Modal -->
        <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                  <form action="/myhotel/delete_bill/" method="post">
                    {% csrf_token %} 

                    <input type="hidden" name="table_no_delete" class="form-control" id="table_no_delete" value={{table_id}}>

                    <div class="modal-header bg-danger text-white">
                        <h5 class="modal-title" id="deleteModalLabel">Confirm Deletion</h5>
                    </div>
                    <div class="modal-body">
                        <p>Are you sure you want to delete All record Of this Table?</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-danger">Delete</button>
                    </div>
                  </form>
                </div>
            </div>
        </div>

    </div>
    <div class="col-6 text-center "><!-- Button to trigger modal -->
        <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#customerModal">
            Customer Details
        </button>

        <!-- Customer Modal -->
        <div class="modal fade" id="customerModal" tabindex="-1" aria-labelledby="customerModalLabel"
            aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="customerModalLabel">Customer Information</h5>
                    </div>
                    <form action="/myhotel/cust_details/" method="post" >
                      {% csrf_token %} 
                    <input type="hidden" class="form-control" name="cust_table_id" id="customerName" value="{{table_id}}" >
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="customerName" class="form-label">Customer Name</label>
                            <input type="text" class="form-control" name="customerName" id="customerName" placeholder="Enter customer name">
                        </div>
                        <div class="mb-3">
                            <label for="customerMobile" class="form-label">Mobile Number</label>
                            <input type="tel" class="form-control" name="customerMobile" id="customerMobile"
                                placeholder="Enter mobile number">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary">Save changes</button>
                    </div>
                  </form>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="card shadow p-3" style="border: 2px solid green;">
    <div class="card-header text-dark">
        <h6 class="card-title mb-0 text-center">{% if customer_data.customer_name %}Customer Name: {{customer_data.customer_name}} / {{customer_data.customer_mobile_number}} {% endif %}</h6>
    </div>
   
      
    <div class="container-fluid">

      <form id="billingForm" action="/myhotel/save_bill/" method="post" onsubmit="addDish()">
        {% csrf_token %}
        <input type="hidden" name="table_no" class="form-control" id="table_no" value={{table_id}}>
        <div class="form-row">
          <div class="form-group col-md-6">
            <label for="dishName">Dish Name</label>
            <input type="text" class="form-control" name="dishName" id="dishName" placeholder="Enter Dish Name" autocomplete="off" required>
          </div>
          <div class="form-group col-md-6">
            <label for="quantity">Quantity</label>
            <input type="number" step="0.01" class="form-control" name="quantity" id="quantity" placeholder="Enter Quantity" required>
          </div>
          <div class="form-group col-md-6">
            <label for="unitPrice">Unit Price</label>
            <input type="number" step="0.01" class="form-control" name="unitPrice" id="unitPrice" placeholder="Enter Unit Price" required>
          </div>
        </div>
        <div class="container text-center">

          <input type="submit" class="btn btn-primary" value="Add Dish">
        </div>
    </form>
    </div>
    </div>
<hr>
        <table class="table table-responsive">
          <thead>
            <tr>
              <th>Dishx </th>
              <th>Price</th>
              <th>Quantity</th>
              <th>Total</th>
              <th>‚ùå</th>
            </tr>
          </thead>
          <tbody id="billTableBody">
            {% for bill in billing_data %}
            <tr>
              <td>{{ bill.Item_Name }}</td>
              <td>{{ bill.unit_Price }}</td> <!-- Use 'unit_Price' instead of 'unit_price' -->
              <td>{{ bill.quantity }}</td> <!-- Use 'unit_Price' instead of 'unit_price' -->
              <td>{{ bill.Total }}</td> <!-- Use 'unit_Price' instead of 'unit_price' -->
              <td><a href="/myhotel/delete_bill_item/{{ bill.pk }}/{{table_id}}"><button class="btn btn-outline-danger btn-sm">X</button></a></td> <!-- Use 'unit_Price' instead of 'unit_price' -->
            </tr>
          {% endfor %}
          </tbody>
        </table>
    
        <div class="form-group">
          <label for="totalAmount">Total Amount</label>
          <input type="text" class="form-control" id="totalAmount" value="{{Total_Count}}" readonly>
        </div>
    <div class="container text-center">

        <a href="/myhotel/generate/{{table_id}}"><button type="button" class="btn btn-info">Print Bill</button></a>
    </div>
    <div class="container" style="display: none;">
    <input type="text" id="Hotel_Name" value="{{user_model.Hotel_Name}}">
    <input type="text" id="address" value="{{user_model.Hotel_Address}}">
    <input type="text" id="mobile_number" value="{{user_model.mobile_number}}">
    <input type="text" id="alternate_number" value="{{user_model.alternate_number}}">
    </div>
    
      <!-- Hidden table to store dish data -->
      <table id="dishDataTable" style="display: none;">
        <thead>
          <tr>
            <th>Dish</th>
            <th>Unit Price</th>
          </tr>
        </thead>
        <tbody>
    {% for dish in dish_data %}
      <tr>
        <td>{{ dish.Item_Name }}</td>
        <td>{{ dish.unit_Price }}</td> <!-- Use 'unit_Price' instead of 'unit_price' -->
      </tr>
    {% endfor %}
    
        </tbody>
      </table>
    
    </div>
    
   
    <script>
      let dishes = [];
      $(function () {
        const availableDishes = [];
      
        // Populate availableDishes from the hidden table
        $("#dishDataTable tbody tr").each(function () {
          const dishName = $(this).find("td:eq(0)").text();
          const unitPrice = parseFloat($(this).find("td:eq(1)").text());
          availableDishes.push({ label: dishName, value: unitPrice });
        });
      
        // console.log("Available Dishes:", availableDishes);
      
        $("#dishName").autocomplete({
          source: availableDishes,
          select: function (event, ui) {
            // Prevent the default behavior of setting the value by the autocomplete
            event.preventDefault();
            // Set the value of the Dish Name and Unit Price input fields
            $("#dishName").val(ui.item.label);
            $("#unitPrice").val(ui.item.value.toFixed(2));
          $("#quantity").focus();
          }
        });
      });
      
    
      function addDish() {
        const dishName = $("#dishName").val();
        const unitPrice = parseFloat($("#unitPrice").val());
        const quantity = parseInt($("#quantity").val());
    
        if (dishName && !isNaN(unitPrice) && unitPrice > 0 && !isNaN(quantity) && quantity > 0) {
          $("#dishName").focus();
    
        } else {
          alert("Please enter valid Dish Name, Unit Price, and Quantity.");
        }
      }
    

      
   
  </script>
    
  


</div>
<br>
<br>


{% endblock %}